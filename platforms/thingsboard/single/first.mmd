```mermaidgraph TB

graph TB    subgraph "External Clients"

    subgraph "ThingsBoard Platform"        WEB[Web Dashboard<br/>:8081]

        TB[tb-node]        MQTT_CLIENT[MQTT Devices<br/>:1884]

        DB[(postgres)]        MQTT_SSL[MQTT SSL Devices<br/>:8884]

    end        COAP[CoAP Devices<br/>:5689-5694/udp]

            EDGE[Edge Devices<br/>:7071]

    TB --> DB    end



    classDef default fill:#ffffff,stroke:#000000,stroke-width:2px,color:#000000    subgraph "Docker Network: tb-allinone-network"

    classDef container fill:#f0f0f0,stroke:#000000,stroke-width:2px,color:#000000        subgraph "ThingsBoard All-in-One Container"

                TB[ThingsBoard Node<br/>tb-node<br/>Port: 9090]

    class TB,DB container            

```            subgraph "Internal Services"
                API[REST API]
                WS[WebSocket]
                MQTT_BROKER[MQTT Broker<br/>Port: 1883]
                COAP_SERVER[CoAP Server<br/>Port: 5683-5688]
                EDGE_RPC[Edge RPC<br/>Port: 7070]
            end
            
            subgraph "Processing"
                RULE_ENGINE[Rule Engine]
                QUEUE[In-Memory Queue]
                CACHE[Caffeine Cache]
            end
        end
        
        subgraph "PostgreSQL Container"
            DB[(PostgreSQL 16<br/>tb-postgres<br/>Port: 5432<br/>Internal Only)]
        end
    end

    subgraph "Docker Volumes"
        DATA_VOL[tb-allinone-data]
        LOGS_VOL[tb-allinone-logs]  
        DB_VOL[tb-allinone-postgres]
    end

    %% External connections
    WEB --> TB
    MQTT_CLIENT --> MQTT_BROKER
    MQTT_SSL --> MQTT_BROKER
    COAP --> COAP_SERVER
    EDGE --> EDGE_RPC

    %% Internal connections
    TB --> API
    TB --> WS
    TB --> MQTT_BROKER
    TB --> COAP_SERVER
    TB --> EDGE_RPC
    TB --> RULE_ENGINE
    TB --> QUEUE
    TB --> CACHE
    
    %% Database connection
    TB --> DB
    
    %% Volume mounts
    TB -.-> DATA_VOL
    TB -.-> LOGS_VOL
    DB -.-> DB_VOL

    %% Styling
    classDef container fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef database fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef volume fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef external fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef service fill:#fff8e1,stroke:#f57f17,stroke-width:2px

    class TB,MQTT_BROKER,COAP_SERVER,EDGE_RPC container
    class DB database
    class DATA_VOL,LOGS_VOL,DB_VOL volume
    class WEB,MQTT_CLIENT,MQTT_SSL,COAP,EDGE external
    class API,WS,RULE_ENGINE,QUEUE,CACHE service